{% extends 'base.html.twig' %}
{% block title %}
{{ annonce.titre }}
{% endblock
%}
{% block css %}
<link rel="stylesheet" href="{{ asset('css/details.css') }}" type="text/css" />

{% endblock %}
{% block body %}
<div class="container h-100 details">
    <div class="row ">
        <div class="col-lg-8 col-sm-12">
            <div id="carouselExampleControls" class="carousel slide w-100 " data-bs-ride="carousel">
                <div class="carousel-inner" role="listbox" data-interval="10000000">
                    {% for image in annonce.images %}
                    <div class="carousel-item {{ loop.first ? 'active' : '' }}">
                        <img src="{{ asset('images/' ~ image.img) }}" class="d-block w-75 m-auto my-2" alt="..." />
                    </div>
                    {% endfor %}
                </div>

                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls"
                    data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls"
                    data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
        <div class="middle d-flex  flex-column col-lg-4 col-sm-12">
            <div class='d-flex justify-content-center align-items-center'>
                {% if annonce.user.avatar %}
                <img class="m-3 avatar"
                    src="https://images.assetsdelivery.com/compings_v2/thesomeday123/thesomeday1231712/thesomeday123171200009.jpg"
                    alt="">
                {% else %}
                <img class="m-3 avatar" src="{{asset('avatars/'~ app.user.avatar)}}" alt="">
                {% endif %}
                <h4 class=' title'>Par :
                    {{annonce.user.pseudo |capitalize }}</h4>
            </div>
            <div class="d-flex flex-column">
                <a class="btn btn-primary my-5">Afficher le Numero de téléphone</a>
                <a class="btn btn-primary">Envoyer un message</a>
            </div>


        </div>
        <div class="col-lg-8 col-sm-12 right ">
            <h1 class='coloredTitle '>{{annonce.titre}}</h1>
            <p class="py-3">{{annonce.contenue}}</p>

            <div class="d-flex justify-content-between">
                {% if annonce.prix is not empty %}
                <span id="price">{{annonce.prix}}
                    €</span>
                {% endif %}
                <small class="text-muted m-1">{{annonce.dateDePublication| ago ( locale = "fr") }}</small>
            </div>
        </div>
        <H3 class="text-muted">Les commentaires</H3>
        <div class="row">
            <div class="col-lg-12 col-sm-12">
                {%for comments in annonce.commentaires%}
                {% if comments.parent == null %}
                <div class="d-flex">
                {%if comments.user.avatar is not empty%}
                <img class='avatar' src="{{asset('avatars/'~ comments.user.avatar)}}" alt="" srcset="">
                {%else%}
                <img class='avatar' src="{{asset('images/avatar.png')}}" alt="" srcset="">
                <p>
                    Publier par: {{comments.user.pseudo}}
                </p>
                {%endif%}
                <div class="card w-75">
                    <div class="card-body">

                        <p>
                            {{comments.contenue}}
                        </p>
                        <div class="d-flex justify-content-end">
                            <small class="text-muted p-3">{{comments.date|ago}}</small>
                        </div>
                    </div>
                </div>
            </div>
                <p><a href="#ajout-commentaire" data-reply data-id="{{comments.id}}"><i class="fas fa-reply"></i>
                        Répondre</a></p>
                {% for reply in comments.reponse %}
                {%if reply.user.avatar is not empty%}
                <img class='avatar' src="{{asset('avatars/'~ comments.user.avatar)}}" alt="" srcset="">
                {%else%}
                <img class='avatar' src="{{asset('images/avatar.png')}}" alt="" srcset="">
                {%endif%}

                <p>
                    Publier par: {{reply.user.pseudo}}
                </p>
                <div class="card w-75">
                    <div class="card-body">

                        <p>
                            {{reply.contenue}}
                        </p>
                        <div class="d-flex justify-content-end">
                            <small class="text-muted p-3">{{reply.date|ago}}</small>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {%endif%}
                {%endfor%}
            </div>
        </div>
        <div id="ajout-commentaire">
            {{form(form)}}

        </div>
    </div>
</div>

<script>
    window.onload = () => {
        // On met un écouteur d'évènements sur tous les boutons répondre
        document.querySelectorAll("[data-reply]").forEach(element => {
            element.addEventListener("click", function () {
                document.querySelector("#commentaire_parentid").value = this.dataset.id;
            });
        });
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

{% endblock %}